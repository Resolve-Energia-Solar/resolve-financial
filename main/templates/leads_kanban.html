{% extends 'base.html' %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/jkanban/jkanban.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/select2/select2.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/flatpickr/flatpickr.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/quill/typography.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/quill/katex.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/quill/editor.css' %}" />
<link rel="stylesheet"
    href="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/css/pages/app-kanban.css' %}" />
{% endblock extra_styles %}

{% block content %}
<div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
        {% csrf_token %}
        <div class="app-kanban" data-board-id="{{ object.id }}">
            <!-- Add new board -->
            <div class="row">
                <div class="col-12">
                    <form class="kanban-add-new-board" method="post">
                        {% csrf_token %}
                        <label class="kanban-add-board-btn" for="kanban-add-board-input">
                            <i class="bx bx-plus me-1"></i>
                            <span class="align-middle">Adicionar nova</span>
                        </label>
                        <input type="text" class="form-control w-px-250 kanban-add-board-input mb-2 d-none" placeholder="Adicionar título da coluna" id="kanban-add-board-input" name="name" required />
                        <div class="mb-3 kanban-add-board-input d-none">
                            <button type="submit" class="btn btn-primary btn-sm me-2">Adicionar</button>
                            <button type="button" class="btn btn-label-secondary btn-sm kanban-add-board-cancel-btn">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Kanban Wrapper -->
            <div class="kanban-wrapper"></div>

            <!-- Edit Task /Task & Activities -->
            <div class="offcanvas offcanvas-end kanban-update-item-sidebar">
                <div class="offcanvas-header border-bottom py-3 my-1">
                    <h5 class="offcanvas-title">Informações do Lead</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body pt-4">
                    <ul class="nav nav-pills tabs-line">
                        <li class="nav-item">
                            <button class="nav-link active shadow-none" data-bs-toggle="tab"
                                data-bs-target="#tab-update">
                                <i class="bx bx-edit me-2"></i>
                                <span class="align-middle text-uppercase">Editar</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link shadow-none" data-bs-toggle="tab" data-bs-target="#tab-activity">
                                <i class="bx bx-bar-chart me-2"></i>
                                <span class="align-middle text-uppercase">Atividades</span>
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content px-0 pb-0 border-0">
                        <!-- Update item/tasks -->
                        <div class="tab-pane fade show active" id="tab-update" role="tabpanel">
                            <form>
                                <div class="mb-3">
                                    <label class="form-label" for="title">Título</label>
                                    <input type="text" id="title" class="form-control" placeholder="Enter Title" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" for="due-date" aria-disabled="true">Criado em</label>
                                    <input type="text" id="due-date" class="form-control" placeholder="Sem data" disabled/>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" for="label">Tipo</label>
                                    <select class="select2 select2-label form-select" id="label">
                                        <option data-color="bg-label-success" value="UX">Pessoa Física</option>
                                        <option data-color="bg-label-warning" value="Images">Pessoa Jurídica</option>
                                        </option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Envolvidos</label>
                                    <div class="assigned d-flex flex-wrap avatar-group"></div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" for="attachments">Anexos</label>
                                    <div>
                                        <input type="file" class="form-control" id="attachments" />
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Comentar</label>
                                    <div class="comment-editor border-bottom-0"></div>
                                    <div class="d-flex justify-content-end">
                                        <div class="comment-toolbar">
                                            <span class="ql-formats me-0">
                                                <button class="ql-bold"></button>
                                                <button class="ql-italic"></button>
                                                <button class="ql-underline"></button>
                                                <button class="ql-link"></button>
                                                <button class="ql-image"></button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex flex-wrap">
                                        <button type="button" class="btn btn-primary me-3" data-bs-dismiss="offcanvas">
                                            Salvar
                                        </button>
                                        <button type="button" class="btn btn-label-secondary"
                                            data-bs-dismiss="offcanvas">
                                            Cancelar
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- Activities -->
                        <div class="tab-pane fade" id="tab-activity" role="tabpanel">
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-success rounded-circle">HJ</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0"><span class="fw-medium">Jordan</span> Left the object.</p>
                                    <small class="text-muted">Today 11:00 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/6.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Dianna</span> mentioned
                                        <span class="fw-medium text-primary">@bruce</span> in a comment.
                                    </p>
                                    <small class="text-muted">Today 10:20 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/2.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Martian</span> added moved Charts & Maps task to the
                                        done object.
                                    </p>
                                    <small class="text-muted">Today 10:00 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/1.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0"><span class="fw-medium">Barry</span> Commented on App review task.
                                    </p>
                                    <small class="text-muted">Today 8:32 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-dark rounded-circle">BW</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0"><span class="fw-medium">Bruce</span> was assigned task of code
                                        review.</p>
                                    <small class="text-muted">Today 8:30 PM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-danger rounded-circle">CK</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Clark</span> assigned task UX Research to
                                        <span class="fw-medium text-primary">@martian</span>
                                    </p>
                                    <small class="text-muted">Today 8:00 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/4.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Ray</span> Added moved
                                        <span class="fw-medium">Forms & Tables</span> task from in progress to done.
                                    </p>
                                    <small class="text-muted">Today 7:45 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/1.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Barry</span> Complete all the tasks assigned to him.
                                    </p>
                                    <small class="text-muted">Today 7:17 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-success rounded-circle">HJ</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0"><span class="fw-medium">Jordan</span> added task to update new
                                        images.</p>
                                    <small class="text-muted">Today 7:00 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <img src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/img/avatars/6.png' %}"
                                        alt="Avatar" class="rounded-circle" />
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Dianna</span> moved task
                                        <span class="fw-medium">FAQ UX</span> from in progress to done object.
                                    </p>
                                    <small class="text-muted">Today 7:00 AM</small>
                                </div>
                            </div>
                            <div class="media mb-4 d-flex align-items-start">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-danger rounded-circle">CK</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0">
                                        <span class="fw-medium">Clark</span> added new board with name
                                        <span class="fw-medium">Done</span>.
                                    </p>
                                    <small class="text-muted">Yesterday 3:00 PM</small>
                                </div>
                            </div>
                            <div class="media d-flex align-items-center">
                                <div class="avatar avatar-sm me-2 flex-shrink-0 mt-1">
                                    <span class="avatar-initial bg-label-dark rounded-circle">BW</span>
                                </div>
                                <div class="media-body">
                                    <p class="mb-0"><span class="fw-medium">Bruce</span> added new task in progress
                                        object.</p>
                                    <small class="text-muted">Yesterday 12:00 PM</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- / Content -->
    {% endblock %}

    {% block extra_scripts %}
    <script id="kanban-json" class="d-none">
        [
            {% for column in object.column_set.all %}
            {
                "id": "{{ column.id }}",
                "title": "{{ column.name }}",
                "item": [
                    {% for card in column.card_set.all %}
                    {
                        "id": "{{ card.id }}",
                        "title": "{% if card.lead %}{{ card.lead.name }}{% else %}{{ card.task.title }}{% endif %}",
                        "attachments": "10",
                        "comments": "5",
                        "badge-text": "{{ card.lead.type }}",
                        "badge": "{% if card.lead.type == "PF" %}success{% else %}warning{% endif %}",
                        "due-date": "{% if card.lead %}{{ card.lead.created_at }}{% else %}{{ card.task.delivery_date }}{% endif %}",
                        "assigned": [
                            "12.png",
                            "5.png"
                        ],
                        "members": [
                            {% for member in card.task.members.all %}
                            "{{ member.username }}"{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        ]
                    }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ]
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    </script>
    <script
        src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/moment/moment.js' %}"></script>
    <script
        src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/flatpickr/flatpickr.js' %}"></script>
    <script
        src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/select2/select2.js' %}"></script>
    <script
        src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/jkanban/jkanban.js' %}"></script>
    <script src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/quill/katex.js' %}"></script>
    <script src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/vendor/libs/quill/quill.js' %}"></script>
    <script src="{% static 'sneat-bootstrap-html-admin-template-v1.7.1/assets/js/app-kanban.js' %}"></script>
    {% endblock extra_scripts %}